function JsonRPC(c,b,d){if(!(this instanceof JsonRPC)){return new JsonRPC(c,b,d)}this.uri=c;if(typeof b!="undefined"){for(var a=0;a<b.length;a++){this.addRPCMethod(b[a],a)}}if(typeof d!="undefined"){for(var a=0;a<d.length;a++){this.addRPCMethod(d[a],null)}}}JsonRPC.prototype.getXHR=function(){var b;if(typeof XMLHttpRequest!="undefined"){b=new XMLHttpRequest()}else{try{b=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{b=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}throw new Error("No XML HTTP Rewquest support")}return b};JsonRPC.prototype.runXHR=function(e,a,f,d){e.setRequestHeader("Content-Type","application/json");var c={id:f,method:a,params:d};var b=JSON.stringify(c);e.send(b)};JsonRPC.prototype.syncCall=function(b,g,f){var d=this.getXHR();d.open("post",this.uri,false);this.runXHR(d,b,g,f);if(d.status!=200){throw Error("Invalid response:"+d.status)}if(g!=null){var a=null;try{a=JSON.parse(d.responseText)}catch(c){throw Error("Invalid JSON-RPC response")}if(a.error!=null){throw Error(a.error)}return a.result}};JsonRPC.prototype.asyncCall=function(b,f,e,c,a){var d=this.getXHR();d.open("post",this.uri,true);d.onreadystatechange=function(){if(d.readyState!=4){return}if(d.status==200){if(f!=null){var g=null;try{g=JSON.parse(d.responseText)}catch(h){a({type:"protocol",error:"invalid response"});return}if(g.error!=null){a({type:"response",error:g.error})}else{c(g.result)}}else{c()}}else{a({type:"transport",error:d.status})}};this.runXHR(d,b,f,e)};JsonRPC.prototype.addRPCMethod=function(c,b){var a=function(){var d=new Array();for(var e=0;e<arguments.length;e++){d[e]=arguments[e]}if(a.on_result!=null){this.asyncCall(c,b,d,a.on_result,a.on_error)}else{return this.syncCall(c,b,d)}};a.on_error=function(d){throw Error(d.error)};a.on_result=null;this[c]=a};